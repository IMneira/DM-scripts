import re, subprocess

FLAG_RE = re.compile(r"\bCDM_[A-Z0-9_]+\b")
SERVER_IP   = "SCOREBOARD_IP"   # <- cÃ¡mbialo
SERVER_PORT = 10166             # <- igual al del reglamento

def extract_flag(text: str):
    m = FLAG_RE.search(text or "")
    return m.group(0) if m else None

def send_flag(flag: str):
    if not FLAG_RE.fullmatch(flag):
        return "[!] Rechazada: no cumple formato CDM_"
    p = subprocess.Popen(["nc", SERVER_IP, str(SERVER_PORT)],
                         stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
    out, _ = p.communicate(input=(flag+"\n").encode())
    return f"[+] Flag enviada: {flag} | Respuesta: {out.decode(errors='ignore').strip()}"
